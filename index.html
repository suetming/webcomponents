<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>Web组件</title>
  <meta name="description" content="Web Components">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Web组件</h1>
    </header>
    <div id="container">
      <p class="tagline">Web Components</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/suetming/webcomponents/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/suetming/webcomponents/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/suetming/webcomponents" class="code">View Web组件 on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h1>
<a name="web" class="anchor" href="#web"><span class="octicon octicon-link"></span></a>Web组件</h1>

<p>译者：suetming</p>

<p>原文：<a href="http://www.w3.org/TR/2013/WD-components-intro-20130606/">Web Components</a></p>

<h2>
<a name="1-" class="anchor" href="#1-"><span class="octicon octicon-link"></span></a>1 关于本文</h2>

<p>注意文章涉及正在开展的工作. 关系到web组件的一系列概念，每个概念都有各自的规范.
这是一个迭代的过程</p>

<p>本文描述的概念有时会落后或者超前于专门界定此概念的规范，一旦本文涉及的前瞻性技术被相应的规范所采纳，本文会更新并注明</p>

<h2>
<a name="2-" class="anchor" href="#2-"><span class="octicon octicon-link"></span></a>2 介绍</h2>

<p>web组件模型由5部分组成：</p>

<ul>
<li>1. Templates：由一系列复用时能被激活的标记组成</li>
<li>2. Decorators：用于Templates中，通过CSS丰富和控制交互改变文本</li>
<li>3. Custom Elements：让用户可以自定义元素[自定义元素名、自定义API接口</li>
<li>4. Shadow DOM：将一组DOM树封装成一个用户接口元素</li>
<li>5. Imports：定义如何将Templates、Decorators和Custom Elements打包，并且能够以资源的形式从外部引用</li>
</ul><p>每一部分都有各自的用途. 如果将这5种技术引入，开发人员可以轻松的编写拥有复杂交互体验的组件，并且可以轻松引用和组装，这是今天的CSS和脚本语言所无法达到的</p>

<p>本文将会讨论这5种技术，并举例说明其在Web组件中的作用</p>

<h2>
<a name="3-templates" class="anchor" href="#3-templates"><span class="octicon octicon-link"></span></a>3 Templates</h2>

<p>具体规范参加这篇<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/templates/index.html">HTML Templates</a></p>

<p>&lt;template&gt;元素及其所包含元素会由解析器进行解析并标记，不过不会立即渲染出来，脚本不会立即执行，包含的图片也不会立即下载</p>

<p>&lt;template&gt;元素有一个属性 <strong>content</strong> 存储元素的实际内容，属性 <strong>content</strong> 的内容可以拷贝移动到HTML节点中</p>

<div class="highlight"><pre><span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"commentTemplate"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"comment-text"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">function</span> <span class="nx">addComment</span><span class="p">(</span><span class="nx">imageUrl</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#commentTemplate"</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">comment</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="c1">// Populate content.</span>
  <span class="nx">comment</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'img'</span><span class="p">).</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">imageUrl</span><span class="p">;</span>
  <span class="nx">comment</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.comment-text'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">comment</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p><strong>template</strong> 所包含的的元素包含在属性 <strong>content</strong> 中，通过script拷贝里面的元素并插入到HTML中使图片加载进来，脚本开始运行. 例如，在templates引入大型脚本，需要时调用</p>

<h2>
<a name="4-decorators" class="anchor" href="#4-decorators"><span class="octicon octicon-link"></span></a>4 Decorators</h2>

<p>Decorators 目前没有标准文档，__decorator__ 主要加强或者重载已经存在的元素，由CSS控制表现，与一般元素不同的是通过标记可以达到额外的效果</p>

<p>&lt;decorator&gt;通过包含&lt;template&gt;来明确具体渲染哪一块</p>

<div class="highlight"><pre><span class="nt">&lt;decorator</span> <span class="na">id=</span><span class="s">"details-open"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;template&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"summary"</span><span class="nt">&gt;</span>
          <span class="ni">&amp;blacktriangledown;</span>
          <span class="nt">&lt;content</span> <span class="na">select=</span><span class="s">"summary"</span><span class="nt">&gt;&lt;/content&gt;</span>
        <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
    <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/decorator&gt;</span>
</pre></div>

<p>&lt;content&gt;包含待渲染的内容，通过CSS控制生效</p>

<div class="highlight"><pre><span class="nt">details</span><span class="o">[</span><span class="nt">open</span><span class="o">]</span> <span class="p">{</span>
    <span class="n">decorator</span><span class="o">:</span> <span class="sx">url(#details-open)</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>通过这种方式可以使下面的html代码</p>

<div class="highlight"><pre><span class="nt">&lt;details</span> <span class="na">open</span><span class="nt">&gt;</span>
    <span class="nt">&lt;summary&gt;</span>Timepieces<span class="nt">&lt;/summary&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>Sundial
      <span class="nt">&lt;li&gt;</span>Cuckoo clock
      <span class="nt">&lt;li&gt;</span>Wristwatch
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/details&gt;</span>
</pre></div>

<p>最终渲染成</p>

<p><a>
  ▾ Timepieces
</a></p>

<ul>
<li>Sundial
  </li>
<li>Cuckoo clock
  </li>
<li>Wristwatch
</li>
</ul><p><strong>decorator</strong> CSS属性可以指向任何网络资源，不过只有其“定义”被调用才能申请，生成的标记仅限于展示，永远不会运行脚本包括内联事件，而且也是不可编辑的</p>

<p>4.1 Decorators的事件
Decorators可以关联事件增强交互，decorator采用事件控制器当做媒介，因为decorator可能在任何时间生效或者失效，所以关联template中监听节点事件或者获取其状态都是无效的</p>

<p><img src="http://www.w3.org/TR/2013/WD-components-intro-20130606/event-handler-registration.png" alt="事件注册"></p>

<p>通过事件控制器注册事件监听器，template中插入&lt;script&gt;，decorator元素插入到文档中时脚本会执行，脚本会被插入到注册队列中:</p>

<div class="highlight"><pre><span class="nt">&lt;decorator</span> <span class="na">id=</span><span class="s">"details-open"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">function</span> <span class="nx">clicked</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="s1">'open'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="p">[{</span><span class="nx">selector</span><span class="o">:</span> <span class="s1">'#summary'</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'click'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">clicked</span><span class="p">}];</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;template&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"summary"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- as illustrated above --&gt;</span>
</pre></div>

<p>事件控制器解析注册事件如图所示</p>

<p><img src="http://www.w3.org/TR/2013/WD-components-intro-20130606/event-routing-retargeting.png" alt="事件的路由和重定向"></p>

<p>事件监听器被调用时，事件的目标是最终生成的内容而不是template中的内容. 点击template中定义的▾，将会调用单击事件（在template中定义的__#summary__元素）, event.target指向&lt;details&gt;，事件的重定向不会影响文档DOM结构</p>

<p>移除属性__open__，由于selector与decorator的属性不匹配，这个decorator不再有效. 未应用的decorator会回到最初的状态. 不过可以再构造一个decorator来渲染__closed__，通过激活不同的decorator可以达到无状态交互，代码如下</p>

<div class="highlight"><pre><span class="nt">&lt;style&gt;</span>
<span class="nt">details</span> <span class="p">{</span>
    <span class="n">decorator</span><span class="o">:</span> <span class="sx">url(#details-closed)</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">details</span><span class="o">[</span><span class="nt">open</span><span class="o">]</span> <span class="p">{</span>
    <span class="n">decorator</span><span class="o">:</span> <span class="sx">url(#details-open)</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;decorator</span> <span class="na">id=</span><span class="s">"details-closed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">function</span> <span class="nx">clicked</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'open'</span><span class="p">,</span> <span class="s1">'open'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="p">[{</span><span class="nx">selector</span><span class="o">:</span> <span class="s1">'#summary'</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'click'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">clicked</span><span class="p">}];</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;template&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"summary"</span><span class="nt">&gt;</span>
            <span class="ni">&amp;blacktriangleright;</span> <span class="nt">&lt;content</span> <span class="na">select=</span><span class="s">"summary"</span><span class="nt">&gt;&lt;/content&gt;</span>
        <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/decorator&gt;</span>

<span class="nt">&lt;decorator</span> <span class="na">id=</span><span class="s">"details-open"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- as illustrated above --&gt;</span>
</pre></div>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/suetming" class="avatar"><img src="https://secure.gravatar.com/avatar/148afaf16136735665c62e1bdc10784e?s=30&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="48" height="48"/></a> <a href="https://github.com/suetming">suetming</a> maintains <a href="https://github.com/suetming/webcomponents">Web组件</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br/>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/suetming/webcomponents/tarball/master" class="tar">tar</a><a href="https://github.com/suetming/webcomponents/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-40716915-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

</body>
</html>
