<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Web组件 by suetming</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/suetming/webcomponents">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/suetming/webcomponents/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/suetming/webcomponents/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Web组件</h1>
          <p>Web Components</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/suetming">suetming</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a name="web" class="anchor" href="#web"><span class="octicon octicon-link"></span></a>Web组件</h1>

<p>译者：suetming</p>

<p>原文：<a href="http://www.w3.org/TR/2013/WD-components-intro-20130606/">Web Components</a></p>

<h2>
<a name="1-" class="anchor" href="#1-"><span class="octicon octicon-link"></span></a>1 关于本文</h2>

<p>注意文章涉及正在开展的工作. 关系到web组件的一系列概念，每个概念都有各自的规范.
这是一个迭代的过程</p>

<p>本文描述的概念有时会落后或者超前于专门界定此概念的规范，一旦本文涉及的前瞻性技术被相应的规范所采纳，本文会更新并注明</p>

<h2>
<a name="2-" class="anchor" href="#2-"><span class="octicon octicon-link"></span></a>2 介绍</h2>

<p>web组件模型由5部分组成：</p>

<ul>
<li>1. Templates：由一系列复用时能被激活的标记组成</li>
<li>2. Decorators：用于Templates中，通过CSS丰富和控制交互改变文本</li>
<li>3. Custom Elements：让用户可以自定义元素[自定义元素名、自定义API接口</li>
<li>4. Shadow DOM：将一组DOM树封装成一个用户接口元素</li>
<li>5. Imports：定义如何将Templates、Decorators和Custom Elements打包，并且能够以资源的形式从外部引用</li>
</ul><p>每一部分都有各自的用途. 如果将这5种技术引入，开发人员可以轻松的编写拥有复杂交互体验的组件，并且可以轻松引用和组装，这是今天的CSS和脚本语言所无法达到的</p>

<p>本文将会讨论这5种技术，并举例说明其在Web组件中的作用</p>

<h2>
<a name="3-templates" class="anchor" href="#3-templates"><span class="octicon octicon-link"></span></a>3 Templates</h2>

<p>具体规范参加这篇<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/templates/index.html">HTML Templates</a></p>

<p>&lt;template&gt;元素及其所包含元素会由解析器进行解析并标记，不过不会立即渲染出来，脚本不会立即执行，包含的图片也不会立即下载</p>

<p>&lt;template&gt;元素有一个属性 <strong>content</strong> 存储元素的实际内容，属性 <strong>content</strong> 的内容可以拷贝移动到HTML节点中</p>

<div class="highlight"><pre><span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"commentTemplate"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"comment-text"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">function</span> <span class="nx">addComment</span><span class="p">(</span><span class="nx">imageUrl</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#commentTemplate"</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">comment</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="c1">// Populate content.</span>
  <span class="nx">comment</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'img'</span><span class="p">).</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">imageUrl</span><span class="p">;</span>
  <span class="nx">comment</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.comment-text'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">comment</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p><strong>template</strong> 所包含的的元素包含在属性 <strong>content</strong> 中，通过script拷贝里面的元素并插入到HTML中使图片加载进来，脚本开始运行. 例如，在templates引入大型脚本，需要时调用</p>

<h2>
<a name="4-decorators" class="anchor" href="#4-decorators"><span class="octicon octicon-link"></span></a>4 Decorators</h2>

<p>Decorators 目前没有标准文档，__decorator__ 主要加强或者重载已经存在的元素，由CSS控制表现，与一般元素不同的是通过标记可以达到额外的效果</p>

<p>&lt;decorator&gt;通过包含&lt;template&gt;来明确具体渲染哪一块</p>

<div class="highlight"><pre><span class="nt">&lt;decorator</span> <span class="na">id=</span><span class="s">"details-open"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;template&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"summary"</span><span class="nt">&gt;</span>
          <span class="ni">&amp;blacktriangledown;</span>
          <span class="nt">&lt;content</span> <span class="na">select=</span><span class="s">"summary"</span><span class="nt">&gt;&lt;/content&gt;</span>
        <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
    <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/decorator&gt;</span>
</pre></div>

<p>&lt;content&gt;包含待渲染的内容，通过CSS控制生效</p>

<div class="highlight"><pre><span class="nt">details</span><span class="o">[</span><span class="nt">open</span><span class="o">]</span> <span class="p">{</span>
    <span class="n">decorator</span><span class="o">:</span> <span class="sx">url(#details-open)</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>通过这种方式可以使下面的html代码</p>

<div class="highlight"><pre><span class="nt">&lt;details</span> <span class="na">open</span><span class="nt">&gt;</span>
    <span class="nt">&lt;summary&gt;</span>Timepieces<span class="nt">&lt;/summary&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>Sundial
      <span class="nt">&lt;li&gt;</span>Cuckoo clock
      <span class="nt">&lt;li&gt;</span>Wristwatch
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/details&gt;</span>
</pre></div>

<p>最终渲染成</p>

<p><a>
  ▾ Timepieces
</a></p>

<ul>
<li>Sundial
  </li>
<li>Cuckoo clock
  </li>
<li>Wristwatch
</li>
</ul><p><strong>decorator</strong> CSS属性可以指向任何网络资源，不过只有其“定义”被调用才能申请，生成的标记仅限于展示，永远不会运行脚本包括内联事件，而且也是不可编辑的</p>

<p>4.1 Decorators的事件
Decorators可以关联事件增强交互，decorator采用事件控制器当做媒介，因为decorator可能在任何时间生效或者失效，所以关联template中监听节点事件或者获取其状态都是无效的</p>

<p><img src="http://www.w3.org/TR/2013/WD-components-intro-20130606/event-handler-registration.png" alt="事件注册"></p>

<p>通过事件控制器注册事件监听器，template中插入&lt;script&gt;，decorator元素插入到文档中时脚本会执行，脚本会被插入到注册队列中:</p>

<div class="highlight"><pre><span class="nt">&lt;decorator</span> <span class="na">id=</span><span class="s">"details-open"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">function</span> <span class="nx">clicked</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="s1">'open'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="p">[{</span><span class="nx">selector</span><span class="o">:</span> <span class="s1">'#summary'</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'click'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">clicked</span><span class="p">}];</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;template&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"summary"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- as illustrated above --&gt;</span>
</pre></div>

<p>事件控制器解析注册事件如图所示</p>

<p><img src="http://www.w3.org/TR/2013/WD-components-intro-20130606/event-routing-retargeting.png" alt="事件的路由和重定向"></p>

<p>事件监听器被调用时，事件的目标是最终生成的内容而不是template中的内容. 点击template中定义的▾，将会调用单击事件（在template中定义的__#summary__元素）, event.target指向&lt;details&gt;，事件的重定向不会影响文档DOM结构</p>

<p>移除属性__open__，由于selector与decorator的属性不匹配，这个decorator不再有效. 未应用的decorator会回到最初的状态. 不过可以再构造一个decorator来渲染__closed__，通过激活不同的decorator可以达到无状态交互，代码如下</p>

<div class="highlight"><pre><span class="nt">&lt;style&gt;</span>
<span class="nt">details</span> <span class="p">{</span>
    <span class="n">decorator</span><span class="o">:</span> <span class="sx">url(#details-closed)</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">details</span><span class="o">[</span><span class="nt">open</span><span class="o">]</span> <span class="p">{</span>
    <span class="n">decorator</span><span class="o">:</span> <span class="sx">url(#details-open)</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;decorator</span> <span class="na">id=</span><span class="s">"details-closed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">function</span> <span class="nx">clicked</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'open'</span><span class="p">,</span> <span class="s1">'open'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="p">[{</span><span class="nx">selector</span><span class="o">:</span> <span class="s1">'#summary'</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'click'</span><span class="p">,</span> <span class="nx">handler</span><span class="o">:</span> <span class="nx">clicked</span><span class="p">}];</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;template&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"summary"</span><span class="nt">&gt;</span>
            <span class="ni">&amp;blacktriangleright;</span> <span class="nt">&lt;content</span> <span class="na">select=</span><span class="s">"summary"</span><span class="nt">&gt;&lt;/content&gt;</span>
        <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/decorator&gt;</span>

<span class="nt">&lt;decorator</span> <span class="na">id=</span><span class="s">"details-open"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- as illustrated above --&gt;</span>
</pre></div>

<h2>
<a name="5-custom-elements" class="anchor" href="#5-custom-elements"><span class="octicon octicon-link"></span></a>5 Custom Elements</h2>

<p>技术规范见此<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/custom/index.html">The Custom Elements specification</a></p>

<p>用户可以构造新的DOM元素，这种技术称之为Custom Elements. 不像decorators，自定义元素可以封装状态并提供脚本接口. 下面的数据表表明两者区别</p>

<table>
<tr>
<td></td>
      <td>Decorators</td>
      <td>Custom Elements</td>
   </tr>
<tr>
<td>Lifetime</td>
      <td>Ephemeral, while a CSS selector matches</td>
      <td>Stable, matches entire element lifetime</td>
   </tr>
<tr>
<td>Applied, unapplied dynamically</td>
      <td>Yes, based on CSS selectors</td>
      <td>No, fixed at element creation time</td>
   </tr>
<tr>
<td>Accessible through script</td>
      <td>No, transparent to DOM; cannot add interfaces</td>
      <td>Yes, accessible through DOM; can provide interfaces</td>
   </tr>
<tr>
<td>State</td>
      <td>Stateless projection</td>
      <td>Stateful DOM object</td>
   </tr>
<tr>
<td>Behavior</td>
      <td>Simulated by changing decorators</td>
      <td>First-class using script and events</td>
   </tr>
</table><h2>
<a name="51-" class="anchor" href="#51-"><span class="octicon octicon-link"></span></a>5.1 构造一个自定义元素</h2>

<p>用&lt;element&gt;构造一个元素，并指明继承哪一个属性如下：</p>

<div class="highlight"><pre><span class="nt">&lt;element</span> <span class="na">extends=</span><span class="s">"button"</span> <span class="na">name=</span><span class="s">"fancy-button"</span><span class="nt">&gt;</span>
    …
<span class="nt">&lt;/element&gt;</span>
</pre></div>

<p><strong>extends</strong>属性标记继承于哪一个元素，自定义元素实例会有此标记名</p>

<p><strong>name</strong>属性指明元素名称，命名必须包含“-”</p>

<p>用户的自定义元素应该继承最接近自己想法的实际存在的元素. 如果用户构造不继承任何元素的自定义元素，user agent会抛出异常<a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#htmlunknownelement">HTMLUnknownElement</a></p>

<h2>
<a name="52-" class="anchor" href="#52-"><span class="octicon octicon-link"></span></a>5.2 方法和属性</h2>

<p>将&lt;script&gt;插入到自定义元素中可以对自定义元素增加方法和属性，下面的例子中元素&lt;tick-tock-clock&gt;增加了tick方法</p>

<div class="highlight"><pre><span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"tick-tock-clock"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="p">({</span>
      <span class="nx">tick</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="err">…</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</pre></div>

<p>5.3 生命周期回调函数
自定义元素有很多回调函数如下：</p>

<ul>
<li>readyCallback：创建时调用</li>
<li>insertedCallback：插入文档时调用</li>
<li>removedCallbakc：删除元素时调用</li>
</ul><p>下面的例子演示如何用template，Shadow DOM (见下一章节)，以及Custom Elements回调函数创建元素：</p>

<div class="highlight"><pre><span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"tick-tock-clock"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"hh"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"sep"</span><span class="nt">&gt;</span>:<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"mm"</span><span class="nt">&gt;&lt;/span&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">template</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">currentScript</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'template'</span><span class="p">);</span>

    <span class="kd">function</span> <span class="nx">start</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_interval</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">stop</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_interval</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">fmt</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">?</span> <span class="s1">'0'</span> <span class="o">:</span> <span class="s1">''</span><span class="p">)</span> <span class="o">+</span> <span class="nx">n</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">({</span>
      <span class="nx">readyCallback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_root</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">start</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">insertedCallback</span><span class="o">:</span> <span class="nx">start</span><span class="p">,</span>
      <span class="nx">removedCallback</span><span class="o">:</span> <span class="nx">stop</span><span class="p">,</span>
      <span class="nx">tick</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_root</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'hh'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">fmt</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getHours</span><span class="p">());</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_root</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'sep'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span>
            <span class="nx">now</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">?</span> <span class="s1">'visible'</span> <span class="o">:</span> <span class="s1">'hidden'</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_root</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'mm'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">fmt</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">());</span>
      <span class="p">},</span>
      <span class="nx">chime</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="err">…</span> <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</pre></div>

<p>5.4 Custom Elements实例化
自定义元素均继承HTML的标准元素(div/button/option/...)， 当用户想用这些元素的时候需要用到属性__is__，如下：</p>

<div class="highlight"><pre><span class="nt">&lt;element</span> <span class="na">extends=</span><span class="s">"button"</span> <span class="na">name=</span><span class="s">"fancy-button"</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- definition --&gt;</span>
    …
<span class="nt">&lt;/element&gt;</span>

<span class="nt">&lt;button</span> <span class="na">is=</span><span class="s">"fancy-button"</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- use --&gt;</span>
    Do something fancy
<span class="nt">&lt;/button&gt;</span>
</pre></div>

<p>5.5 Script实例化Custom Elements
通过脚本语言也可以实例化自定义元素，方法为__register__，具体见下述代码：</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HTMLButtonElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{});</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">dazzle</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="err">…</span> <span class="p">};</span>

<span class="c1">// 返回实例化对象</span>
<span class="kd">var</span> <span class="nx">FancyButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">'button'</span><span class="p">,</span> <span class="s1">'fancy-button'</span><span class="p">,</span> <span class="p">{</span><span class="nx">prototype</span><span class="o">:</span> <span class="nx">p</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FancyButton</span><span class="p">();</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dazzle</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>也可以直接通过createElement生成：</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'button'</span><span class="p">,</span> <span class="s1">'fancy-button'</span><span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">);</span> <span class="c1">// will display '&lt;button is="fancy-button"&gt;&lt;/button&gt;'</span>
<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'tick-tock-clock'</span><span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">);</span> <span class="c1">// will display '&lt;tick-tock-clock&gt;&lt;/tick-tock-clock&gt;'</span>
</pre></div>

<h2>
<a name="56-" class="anchor" href="#56-"><span class="octicon octicon-link"></span></a>5.6 元素更新</h2>

<p>当元素定义调用的时候，每一个匹配的元素都会进行更新. 更新元素后，元素相应API会生效，生命周期相关函数会被调用.
通过CSS__:unresolved__可以匹配所有为构造的自定义元素，通过这种方式避免更新元素所造成的闪烁</p>

<div class="highlight"><pre><span class="nt">&lt;style&gt;</span>
<span class="nt">tick-tock-clock</span><span class="nd">:unresolved</span> <span class="p">{</span>
  <span class="k">content</span><span class="o">:</span> <span class="s1">'??:??'</span><span class="p">;</span>  
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;tick</span><span class="na">-tock-clock</span><span class="nt">&gt;</span><span class="err">&lt;</span>/tick-tock-clock&gt; <span class="c">&lt;!-- will show ??:?? --&gt;</span>
</pre></div>

<p>也可以通过脚本进行控制</p>

<div class="highlight"><pre><span class="c1">// Chime ALL the clocks!</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'tick-tock-clock:not(:unresolved)'</span><span class="p">),</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">clock</span><span class="p">)</span> <span class="p">{</span> <span class="nx">clock</span><span class="p">.</span><span class="nx">chime</span><span class="p">();</span> <span class="p">});</span>
</pre></div>

<p>通过自定义事件元素可以通知页面其他部分元素已经更新，可以等到元素更新完成，脚本在对其进行操作</p>

<p>5.7 扩展Custom Elements
元素也可以继承自定义元素，代码如下：</p>

<div class="highlight"><pre><span class="nt">&lt;element</span> <span class="na">extends=</span><span class="s">"tick-tock-clock"</span> <span class="na">name=</span><span class="s">"grand-father-clock"</span><span class="nt">&gt;</span>
    …
<span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'tick-tock-clock'</span><span class="p">)));</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">popOutBirdie</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="err">…</span> <span class="p">}</span>
<span class="kd">var</span> <span class="nx">CuckooClock</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">'cuckoo-clock'</span><span class="p">,</span> <span class="p">{</span><span class="nx">prototype</span><span class="o">:</span> <span class="nx">p</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CuckooClock</span><span class="p">();</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">tick</span><span class="p">();</span>         <span class="c1">// inherited from tick-tock-clock</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">popOutBirdie</span><span class="p">();</span> <span class="c1">// specific to cuckoo-clock</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<h2>
<a name="6-shadow-dom" class="anchor" href="#6-shadow-dom"><span class="octicon octicon-link"></span></a>6 Shadow DOM</h2>

<p>相应规范见这里<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html">The Shadow DOM specification</a></p>

<p>Shadow DOM 是一种DOM节点的辅助树. Shadow DOM 子树能够关联某个元素，但不会显示在元素子节点中，子树有自己的作用域. 例如，一个shadow DOM 子树可以和文档中相同ID和风格的元素而不冲突，因为shadow DOM 子树与文档是完全分离的</p>

<p>Shadow DOM 通过<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html#api-partial-element-create-shadow-root"><strong>createShadowRoot</strong></a>方法生效，返回shadow DOM的根节点并填充到DOM节点中</p>

<p></p>

<p>关联shadow DOM的元素称为<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html#dfn-shadow-host">shadow host</a>. 当元素存在shadow DOM，元素的子节点不会渲染；渲染的是shadow DOM的内容</p>

<p></p>

<p>6.1 插入点
shadow DOM 子树通过&lt;content&gt;元素作为渲染输出插入点. &lt;content&gt;只是作为渲染输出的插入点，如下：</p>

<div class="highlight"><pre><span class="c">&lt;!-- document --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"news"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Good day for kittens<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"breaking"</span><span class="nt">&gt;</span>Kitten rescued from tree<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div&gt;</span>Area kitten "adorable"<span class="ni">&amp;mdash;</span>owner<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"breaking"</span><span class="nt">&gt;</span>Jiggled piece of yarn derails kitten kongress<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="c">&lt;!-- #news' shadow --&gt;</span>
<span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"t"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;content</span> <span class="na">select=</span><span class="s">"h1"</span><span class="nt">&gt;&lt;/content&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"ticker"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;content</span> <span class="na">id=</span><span class="s">"stories"</span><span class="nt">&gt;&lt;/content&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/template&gt;</span>

<span class="c">&lt;!-- #ticker's shadow --&gt;</span>
<span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"u"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;content</span> <span class="na">class=</span><span class="s">"highlight"</span> <span class="na">select=</span><span class="s">".breaking"</span><span class="nt">&gt;&lt;/content&gt;</span>
  <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
<span class="nt">&lt;/template&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="c1">// Set up shadow DOM</span>
<span class="kd">var</span> <span class="nx">news</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#news'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">news</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#t'</span><span class="p">);</span>
<span class="nx">r</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>

<span class="kd">var</span> <span class="nx">ticker</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#ticker'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">ticker</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">u</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#u'</span><span class="p">);</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">u</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p>理论上，第一部分文档和第一部分shadow根节点生成了下面的DOM树. 宿主元素的子节点显示在插入点的位置. </p>

<pre><code>&lt;div id="news"&gt;
  &lt;h1&gt;Good day for kittens&lt;/h1&gt;
  &lt;div id="ticker"&gt;
    &lt;div class="breaking"&gt;Kitten rescued from tree&lt;/div&gt;
    &lt;div&gt;Area kitten "adorable"&amp;mdash;owner&lt;/div&gt;
    &lt;div class="breaking"&gt;Jiggled piece of yarn derails kitten kongress&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>第二部分，由于&lt;content class="highlight" select=".breaking"&gt;所有类属性为breaking的排在顶部，这种方式称为<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html#reprojection">reprojection</a></p>

<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"news"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Good day for kittens<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"ticker"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"breaking"</span><span class="nt">&gt;</span>Kitten rescued from tree<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"breaking"</span><span class="nt">&gt;</span>Jiggled piece of yarn derails kitten kongress<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>Area kitten "adorable"<span class="ni">&amp;mdash;</span>owner<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>6.3 备用内容
插入点可以有_content_，称为<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html#dfn-fallback-content">备用内容</a>，当插入点没有任何文本时，会显示此信息，如下：</p>

<div class="highlight"><pre><span class="c">&lt;!-- #news' shadow --&gt;</span>
<span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"t"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;content</span> <span class="na">select=</span><span class="s">"h1"</span><span class="nt">&gt;</span>Today's top headlines<span class="nt">&lt;/content&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"ticker"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;content</span> <span class="na">id=</span><span class="s">"stories"</span><span class="nt">&gt;</span>
      No news
      <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">"window.location.reload(true);"</span><span class="nt">&gt;</span>Reload<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/content&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/template&gt;</span>
</pre></div>

<h2>
<a name="64-shadow" class="anchor" href="#64-shadow"><span class="octicon octicon-link"></span></a>6.4 多重Shadow子树</h2>

<p>一个元素可以含有不止一个shadow DOM 子树. 继承一个已具有shadow DOM子树的自定义元素是很常见的. 不过要是想重用原先的元素时怎么处理? 如何重用?
利用&lt;shadow&gt;可以调用原先申请的shadow DOM 子树，如下：</p>

<div class="highlight"><pre><span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"sailing-watch"</span> <span class="na">extends=</span><span class="s">"tick-tock-clock"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;shadow&gt;&lt;/shadow&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"compass"</span><span class="nt">&gt;</span>N<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="err">…</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</pre></div>

<p>由于一个元素可以有多个shadow，我们需要了解这些shadow如何相互影响，如何作用元素的子节点</p>

<p>由于你不能删除shadow root，所以shadow DOM子树生效时的顺序很重要，如下：</p>

<ul>
<li>1. user agent shadow DOM</li>
<li>2. 自定义元素的shadow DOM</li>
<li>3. 第一个派生自定义元素的shadow DOM</li>
<li>4. ...</li>
<li>5. 用脚本添加的Ad-hoc shadow DOM</li>
<li>6. Decorator shadow (applied and removed with CSS rules—not technically shadow DOM, but its insertion points work similarly to shadow DOM.)</li>
</ul><p>其次，根据顺序从最新生效的子树反向推倒，每一个&lt;content&gt;插入点，根据规则，可以定位任何宿主元素子节点</p>

<p>一旦子节点在正确的地方渲染，我们可以检查是否有&lt;shadow&gt;元素，如果没有，表明成功；如果有，从&lt;shadow&gt;队列元素中取出子树重复替换&lt;content&gt;插入点，直到队尾. 具体见如下图：</p>

<p></p>

<p>总结一下：</p>

<ul>
<li>最近申请的shadow DOM 子树最可能在&lt;content&gt;插入点获得最新的子树</li>
<li>以此类推</li>
<li>直到当前的shadow DOM子树没有&lt;shadow&gt;，那么其就是这个元素最后的DOM子树</li>
</ul><h2>
<a name="65-css--shadow-dom" class="anchor" href="#65-css--shadow-dom"><span class="octicon octicon-link"></span></a>6.5 CSS 和 Shadow DOM</h2>

<p>当构建自定义元素时自然要考虑属性、内容和API接口. 这与页面渲染同等重要. Shadow DOM 提供给开发者很多方式控制shadow DOM内容的样式.</p>

<p>shadow DOM 子树有一个不看见的边界，user agent的样式默认生效，而不是定制的样式. 派生的元素依旧有效，这不是我们想要的. 在上面的scailing-watch的例子里，如果页面内容被渲染成绿色，如果要保持整体风格，shadow DOM内的文本由于color属性由于继承性质也会是绿色，不过设定了所有&lt;div&gt;元素橙色边框， 那direction indicator不会有橙色边框因为__border__并不是具有继承性质的属性</p>

<p>一个shadow根节点有两个属性控制行为. applyAuthorStyles（开发者样式）属性，shadow DOM 会匹配最接近的样式，注意这个属性只能匹配shadow DOM 子树. 使用时要注意"n"代选择器</p>

<p>如果__applyAuthorStyles__设置为false，__resetStyleInheritance__设置为true，样式会清空. 元素会被与页面样式隔离，你可以通过浏览器重置样式</p>

<p>在插入点有相似的界限. shadow DOM子树的样式不会再插入点分布的元素上生效. 不过要是通过选择器想渲染某一部分特定内容， 可以用<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html#distributed-pseudo-element">::distributed pseudo-selector</a>，如下：</p>

<div class="highlight"><pre><span class="c">&lt;!-- #ticker's shadow --&gt;</span>
<span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"u"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;style&gt;</span>
    <span class="nt">content</span><span class="o">:</span><span class="nd">:distributed</span><span class="o">(*)</span> <span class="p">{</span>
      <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">*:</span><span class="nd">:distributed</span><span class="o">(</span><span class="nc">.breaking</span><span class="o">)</span> <span class="p">{</span>
      <span class="k">text-shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0.2em</span> <span class="nb">maroon</span><span class="p">;</span>
      <span class="k">color</span><span class="o">:</span> <span class="nb">orange</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;content</span> <span class="na">class=</span><span class="s">"highlight"</span> <span class="na">select=</span><span class="s">".breaking"</span><span class="nt">&gt;&lt;/content&gt;</span>
  <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
<span class="nt">&lt;/template&gt;</span>
</pre></div>

<p>上述包含了两个规则，选择器的左半部分是shadow DOM 生效；括号内代表适用元素。第一个选择器对&lt;content&gt;的所有元素有效；第二个选择器对类对象为breaking的元素有效</p>

<p>ShadowDOM 也可以定制宿主元素的样式. 代码如下：</p>

<div class="highlight"><pre><span class="c">&lt;!-- #ticker's shadow --&gt;</span>
<span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"u"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;style&gt;</span>
    <span class="k">@host</span> <span class="p">{</span>
      <span class="nd">:scope</span> <span class="p">{</span>
        <span class="k">white-space</span><span class="o">:</span> <span class="k">nowrap</span><span class="p">;</span>
        <span class="k">overflow</span><span class="o">-</span><span class="n">style</span><span class="o">:</span> <span class="n">marquee</span><span class="o">-</span><span class="n">line</span><span class="p">;</span>
        <span class="k">overflow-x</span><span class="o">:</span> <span class="n">marquee</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nt">content</span><span class="o">:</span><span class="nd">:distributed</span><span class="o">(*)</span> <span class="p">{</span>
      <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">*:</span><span class="nd">:distributed</span><span class="o">(</span><span class="nc">.breaking</span><span class="o">)</span> <span class="p">{</span>
      <span class="k">text-shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0.2em</span> <span class="nb">maroon</span><span class="p">;</span>
      <span class="k">color</span><span class="o">:</span> <span class="nb">orange</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;content</span> <span class="na">class=</span><span class="s">"highlight"</span> <span class="na">select=</span><span class="s">".breaking"</span><span class="nt">&gt;&lt;/content&gt;</span>
  <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
<span class="nt">&lt;/template&gt;</span>
</pre></div>

<p>最后，有两种方式可以使shadow DOM 子树的样式与页面保持一致. 首先通过分配一个伪ID暴漏shadow DOM 子树中的特定元素，开发者可以定制其样式. 例如：</p>

<div class="highlight"><pre><span class="nt">&lt;script&gt;</span>
<span class="c1">// Set up shadow DOM</span>
<span class="err">…</span>
<span class="kd">var</span> <span class="nx">ticker</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#ticker'</span><span class="p">);</span>
<span class="nx">ticker</span><span class="p">.</span><span class="nx">pseudo</span> <span class="o">=</span> <span class="s1">'x-ticker'</span><span class="p">;</span>
<span class="err">…</span>
<span class="nt">&lt;/script&gt;</span>

<span class="c">&lt;!-- change the appearance of the ticker part --&gt;</span>
<span class="nt">&lt;style&gt;</span>
<span class="nf">#news</span><span class="o">:</span><span class="nd">:x-ticker</span> <span class="p">{</span>
  <span class="k">background</span><span class="o">:</span> <span class="nb">gray</span><span class="p">;</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">lightblue</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
</pre></div>

<p>另一种方法是通过CSS变量进行控制，如下：</p>

<div class="highlight"><pre><span class="c">&lt;!-- #ticker's shadow --&gt;</span>
<span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"u"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;style&gt;</span>
    <span class="k">@host</span> <span class="p">{</span>
      <span class="nd">:scope</span> <span class="p">{</span>
        <span class="k">white-space</span><span class="o">:</span> <span class="k">nowrap</span><span class="p">;</span>
        <span class="k">overflow</span><span class="o">-</span><span class="n">style</span><span class="o">:</span> <span class="n">marquee</span><span class="o">-</span><span class="n">line</span><span class="p">;</span>
        <span class="k">overflow-x</span><span class="o">:</span> <span class="n">marquee</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nt">content</span><span class="o">:</span><span class="nd">:distributed</span><span class="o">(*)</span> <span class="p">{</span>
      <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">*:</span><span class="nd">:distributed</span><span class="o">(</span><span class="nc">.breaking</span><span class="o">)</span> <span class="p">{</span>
      <span class="k">text-shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0.2em</span> <span class="n">var</span><span class="p">(</span><span class="n">highlight</span><span class="o">-</span><span class="n">accent</span><span class="o">,</span> <span class="nb">maroon</span><span class="p">);</span>
      <span class="k">color</span><span class="o">:</span> <span class="n">var</span><span class="p">(</span><span class="n">highlight</span><span class="o">-</span><span class="n">primary</span><span class="o">,</span> <span class="nb">orange</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;content</span> <span class="na">class=</span><span class="s">"highlight"</span> <span class="na">select=</span><span class="s">".breaking"</span><span class="nt">&gt;&lt;/content&gt;</span>
  <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
<span class="nt">&lt;/template&gt;</span>

<span class="c">&lt;!-- change the appearance of the ticker part --&gt;</span>
<span class="nt">&lt;style&gt;</span>
<span class="nf">#news</span><span class="o">:</span><span class="nd">:x-ticker</span> <span class="p">{</span>
  <span class="k">background</span><span class="o">:</span> <span class="nb">gray</span><span class="p">;</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">lightblue</span><span class="p">;</span>
  <span class="n">var</span><span class="o">-</span><span class="n">highlight</span><span class="o">-</span><span class="n">primary</span><span class="o">:</span> <span class="nb">green</span><span class="p">;</span>
  <span class="n">var</span><span class="o">-</span><span class="n">highlight</span><span class="o">-</span><span class="n">accent</span><span class="o">:</span> <span class="nb">yellow</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
</pre></div>

<p>伪元素方法针对特定元素保持页面样式非常有用，而CSS变量则对不想重复指定的属性集（主题风格）非常有用. </p>

<h2>
<a name="66-shadow-dom" class="anchor" href="#66-shadow-dom"><span class="octicon octicon-link"></span></a>6.6 Shadow DOM中的事件</h2>

<p>为了确保shadow DOM子树中的元素不会暴露给外部子树，会有很多工作来分发内部子树事件. 
首先，shadow DOM 子树会阻止事件如mutation和selectstart外部监听. 那些能够穿过shadow DOM的范围并且重定向的的事件，它们的__target__和__relatedTarget__的会指向shadow DOM子树的宿主元素. 在一些情况下，如__DOMFocusIn__，__mouseover__，__mouseout__事件需要特别注意，如果你在shadow DOM的两个元素中间移动鼠标，会出现鼠标从本身移动到它本身这种诡异的事件</p>

<h2>
<a name="7-imports" class="anchor" href="#7-imports"><span class="octicon octicon-link"></span></a>7 Imports</h2>

<p>规范标准见这里<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/imports/index.html">The HTML Imports specification</a></p>

<p>Custom elements 和 decorators可以通过文件的方式引入：</p>

<div class="highlight"><pre><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"import"</span> <span class="na">href=</span><span class="s">"goodies.html"</span><span class="nt">&gt;</span>
</pre></div>

<p>只有&lt;decorator&gt;元素和&lt;element&gt;能被user agent解析，脚本也可以通过__import__属性获取DOM.  跨域检索的文档可以通过CORS判定这些定义是否可以跨站运行. </p>

<p>SuetMing 保留部分权力。基于“<a href="http://creativecommons.org/licenses/by-sa/3.0/">CC 3.0 BY-SA 协议</a>”发布</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-40716915-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>